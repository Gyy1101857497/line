<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link href="jquery-ui.css" rel="stylesheet">
		<style type="text/css">
			body,html{
				width:100%;
				height: 100%;
			}
			.ui-widget-content{
				border:none;
			}
			.dragLineBox{
			    min-width:50px;min-height:20px;position:absolute;cursor: move;z-index:1;
			}
			.dragLine_horizontal{
			    border-top:#000 solid 1px;width:100%;height:1px;margin:10px 0px;
			}
			.dragLine_vertical{
			    border-left:#000 solid 1px;width:1px;height:100%;margin:0px 10px;
			}
			.rotateTip{
			    border: 1px solid red;width:10px;height:10px;position:absolute;cursor:pointer;z-index: 10;
			}
		</style>
	</head>
	<body>
		<button id="addLine">新增线条</button>
 
	</body>
	<script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="jquery-ui.js"></script>
	<script type="text/javascript">
	$.draw = function(ope,param1,param2){
	  switch(ope){
	       case 'addLine':
				var curBox="";
				var curLine="";
				var rotateTip = $('<div class="rotateTip"></div>');  //创建线旋转提示框
		        var dragLineBox = $('<div class="dragLineBox" direction="horizontal" loopid="'+param2+'"></div>');
		        var dragLine = $('<div class="dragLine_horizontal"></div>');
		        dragLineBox.append(dragLine);
		        param1.append(dragLineBox);
		        if (!$('.rotateTip')[0]) {
		            param1.append(rotateTip);
		        }
		        rotateTip = $('.rotateTip');
				//------线拖动-------//
				dragLineBox.draggable({
					scroll: false,   //拖动自动滚动
		   		    containment:param1, //containment 选项来指定一个父级的 DOM 元素或者一个 jQuery 选择器
					drag:function(event,ui){
						 curBox = dragLineBox;
		                 curLine = dragLine;
						if (curBox.attr('direction') == 'horizontal') {
		                        rotateTip.css('left',ui.position.left + dragLineBox.width()/2);
		                        rotateTip.css('top',ui.position.top - 10);
		                 }else{
		                        rotateTip.css('top',ui.position.top + curBox.height()/2);
		                        rotateTip.css('left',ui.position.left + 20);
		                 }
					}
				})
				dragLineBox.resizable({
					 handles: "e, w",
					 resize: function( event, ui ) {
		                   rotateTip.css('left',ui.position.left + ui.size.width/2);
		                    rotateTip.css('top',ui.position.top - 10);
		                    curBox = dragLineBox;
		                    curLine = dragLine;
		             }
				})
				rotateTip.unbind().click(function(){
					var x = curBox.offset().left;  //距离文档左端位置
					var y = curBox.offset().top;   //距离文档顶端位置
					var direction = curBox.attr("direction");
					//------判断线框处于横／竖状态--------//
					if(direction == "horizontal"){
						var lineWidth = curLine.width();
						curBox.attr("direction","vertical");
						curBox.css("height",lineWidth);
						curBox.css("width","10px");
						curLine.removeClass("dragLine_horizontal").addClass("dragLine_vertical");
						rotateTip.css("top",y+lineWidth/2).css("left",x+20);
						//-------重新对线框进行伸缩初始化----------//
						curBox.resizable({
						 handles: "n, s",
						 resize: function( event, ui ) {
		                    rotateTip.css('top',ui.position.top + ui.size.height/2);
		                    rotateTip.css('left',ui.position.left + 20);
		                    curBox = dragLineBox;
		                    curLine = dragLine;
			             }
				       })
					}else{
						var lineHeight = curLine.height();
						curBox.attr("direction","horizontal");
						curBox.css("width",lineHeight);
						curBox.css("height","10px");
						curLine.removeClass("dragLine_vertical").addClass("dragLine_horizontal");
						rotateTip.css('top',y-10).css('left',x+lineHeight/2);
						//-------重新对线框进行伸缩初始化----------//
						 curBox.resizable({
						 handles: "e, w",
						 resize: function( event, ui ) {
			                   rotateTip.css('left',ui.position.left + ui.size.width/2);
			                    rotateTip.css('top',ui.position.top - 10);
			                    curBox = dragLineBox;
			                    curLine = dragLine;
			             }
				  })
				}
			  })
			 break;
	   }
	}	
	
	$("#addLine").click(function(){
		$.draw('addLine',$('body'))
	})
	</script>
	
</html>
